$(function(n){n.fn.hScroll=function(t){t=t||120;n(this).bind("DOMMouseScroll mousewheel",function(i){var r=i.originalEvent,f=r.detail?r.detail*-t:r.wheelDelta,u=n(this).scrollLeft();u+=f>0?-t:t;n(this).scrollLeft(u);i.preventDefault()})}});$(function(){general.init();navbar.init();anim.init();timeline.init();statusMessage.init();armory.init()});var general={init:function(){$(".logout-btn").click(function(){var n=$("#logoutForm");n!==null&&$("#logoutForm").submit()});$('[data-toggle="tooltip"]').tooltip({container:"body"});$('[data-toggle="popover"]').popover({container:"body"})}},anim={lastScrollY:0,ticking:!1,_this:null,elements:null,init:function(){_this=this;_this.elements=$("[data-animate]");window.addEventListener("scroll",_this.onScroll,!1);_this.update()},onScroll:function(){_this.lastScrollY=window.scrollY;_this.requestTick()},requestTick:function(){_this.ticking||(requestAnimationFrame(_this.update),_this.ticking=!0)},update:function(){for(var n,t=_this.elements.length-1;t>=0;t--)(n=$(_this.elements[t]),n.hasClass(n.data("animate")))||_this.isInViewport(n)&&_this.triggerAnimate(n);_this.ticking=!1},isInViewport:function(n){var t=n.offset().top,i=n.offset().top+n.outerHeight(),r=$(window).scrollTop()+$(window).height(),u=$(window).scrollTop();return r>t&&u<i},triggerAnimate:function(n){var r=n.data("animate"),u=n.data("animate-infinite")||null,t=n.data("animate-delay")||null,i=n.data("animate-duration")||null;u!==null&&n.addClass("infinite");t!==null&&n.css({"-webkit-animation-delay":t+"s","-moz-animation-delay":t+"s","animation-delay":t+"s"});i!==null&&n.css({"-webkit-animation-duration":i+"s","-moz-animation-duration":i+"s","animation-duration":i+"s"});n.addClass("animated "+r).one("webkitAnimationEnd mozAnimationEnd MSAnimationEnd oanimationend animationend",function(){n.addClass("animated-end")})}},navbar={init:function(){window.utils.isMobile()||(this.dropdownHover(),this.transparentFixed());$(".navbar-nav .dropdown-item").click(function(n){n.stopPropagation()});$(".dropdown-submenu .dropdown-toggle").click(function(n){n.preventDefault();$(this).parent().toggleClass("show");$(this).siblings(".dropdown-menu").toggleClass("show")});this.fixedBottom()},dropdownHover:function(){var n=$(".navbar-nav .dropdown");n.each(function(){var n=$(this);n.hover(function(){n.addClass("show")},function(){n.removeClass("show")})})},transparentFixed:function(){var n=$(".navbar"),t,i;n.hasClass("bg-transparent")&&n.hasClass("fixed-top")&&(t=n.offset().top+1,i=function(){var i=window.scrollY||window.pageYOffset;i>=t&&n.hasClass("bg-transparent")?n.removeClass("bg-transparent"):i<t&&!n.hasClass("bg-transparent")&&n.addClass("bg-transparent")},$(window).scroll(i))},fixedBottom:function(){if($navbar=$(".navbar"),$navbar.hasClass("navbar-fixed-bottom"))var n=$navbar.offset().top+1,t=function(){var t=window.scrollY||window.pageYOffset;t>=n&&!$navbar.hasClass("navbar-fixed-bottom--stick")?$navbar.addClass("navbar-fixed-bottom--stick"):t<n&&$navbar.hasClass("navbar-fixed-bottom--stick")&&$navbar.removeClass("navbar-fixed-bottom--stick")};$(window).scroll(t)}},changelog={init:function(){$("#changelog-select").on("change",function(){location.href="/changelog/"+$(this).val()})}},timeline={init:function(){var t=$("#timeline"),n=t.find(".timeline-item");n.on("click",function(){var t=$(this),n;t.hasClass("current")||t.hasClass("future")||(n=t.find(".content"),n.is(":visible")?n.hide("fast"):n.show("fast"))});$.each(n,function(n,t){$(t).hasClass("past")&&$(t).find(".content").hide()})}},statusMessage={init:function(){$("#alert-container").on("click",".alert",function(){$(this).hide("fast")})},show:function(n,t){$("#alert-container").append('<div class="container"><div class="alert text-lg-center"><i class="fa fa-'+t.Icon+" alert-icon "+t.Type+'"><\/i>'+n+"<\/div><\/div>")},showSuccess:function(n){this.show(n,{Type:"success",Icon:"check"})},showError:function(n){this.show(n,{Type:"error",Icon:"warning"})},showResponse:function(n){var t={Type:n.IsErrorResponse?"error":"success",Icon:n.IsErrorResponse?"warning":"check"};this.show(n.Message,t)},showJson:function(n){this.show(n.Message,n.Options)}},tooltips={init:function(n){var t,r,i;typeof $WowheadPower=="undefined"&&(t=document.createElement("script"),t.src="//db.endless.gg/static/widgets/power.js",$("head").append(t),r={hide:{sellprice:!0,reagents:!0}},i=document.createElement("script"),i.innerHTML="var aowow_tooltips = "+JSON.stringify(n?n:r),$("head").append(i))},refreshLinks:function(){typeof $WowheadPower!="undefined"&&window.$WowheadPower.refreshLinks()}},armory={init:function(){$("#armory-search").keypress(function(n){var t=$(this).val(),i=n.keyCode?n.keyCode:n.which;i=="13"&&t.length>=2&&(window.location="/armory/search/"+t)});$(".nav-scroller .nav").hScroll(20)},initInstanceSelect:function(n){$("#instance-select").on("change",function(){location.href="/armory/pve/leaderboards/"+n+"/"+$(this).val()})}};window.utils={isFirefox:function(){return navigator.userAgent.toLowerCase().indexOf("firefox")>-1},isSafari:function(){return navigator.userAgent.toLowerCase().indexOf("safari")>-1},isMobile:function(){return window.innerWidth<=1024?!0:!1},getModelViewerAspect:function(){return window.innerWidth<568?window.innerWidth<374?1.1:1:1.4}};Utilities=function(){this.ajaxDialogResponseTemplate=null};Utilities.prototype={ajaxGet:function(n,t){this.ajaxRequest(n,"GET",null,t,!1)},ajaxPost:function(n,t,i){this.ajaxRequest(n,"POST",t,i,!0)},ajaxRequest:function(n,t,i,r,u){$.ajax({url:n,headers:u?{RequestVerificationToken:$('input:hidden[name="__RequestVerificationToken"]').val()}:null,data:i,type:t,error:function(n){r(n.responseJSON)},success:function(n){r(n)}})},ajaxDialog:function(n){var r=this,t=$("#ajax-dialog"),e=t.find(".modal-body"),f=t.find("#action-button"),o=t.find(".close"),i,u;t.find(".modal-title").text(n.Title);e.html(n.Body);f.text(n.ActionButtonText);i=t.modal();r.ajaxDialogResponseTemplate===null&&(r.ajaxDialogResponseTemplate=Handlebars.compile($("#ajax-dialog-response-tmpl").html()));i.off("click","#action-button");f.show();u=Ladda.create(document.querySelector("#action-button"));i.on("hide.bs.modal",function(n){if(u.isLoading())return n.preventDefault(),n.stopPropagation(),!1});i.on("click","#action-button",function(){u.start();o.hide();var t=function(t){if(u.remove(),o.show(),f.hide(),e.html(r.ajaxDialogResponseTemplate(t)),!t.IsErrorResponse&&n.Request.OnSuccessCloseCallback)i.one("hide.bs.modal",function(){n.Request.OnSuccessCloseCallback(t)})};r.ajaxRequest(n.Request.Url,n.Request.Method,n.Request.Data,t,n.Request.Method==="POST")})},renderTemplate:function(n,t,i,r,u){i instanceof jQuery||(i=i.substring(0,1)==="#"?i:"#"+i,i=$(i));n instanceof jQuery||(n=n.substring(0,1)==="#"?n:"#"+n,n=$(n));var e=Handlebars.compile(n.html()),f=e(t);r?i.append(f):u?i.after(f):i.html(f)},clearBsAlertMessage:function(){$("#bs-alert-content").remove()},showBsAlertMessage:function(n,t,i){var r=this,u=t?"fa fa-check":"fa fa-exclamation-circle",f={Message:n,Type:t?"warning":"success",Icon:u};r.renderTemplate("#bs-alert-tmpl",f,i)},showBsAlertMessageFromResponse:function(n,t){var i=this,r=n.IsErrorResponse?"fa fa-exclamation-circle":"fa fa-check",u={Message:n.Message,Type:n.IsErrorResponse?"warning":"success",Icon:r};i.renderTemplate("#bs-alert-tmpl",u,t)},initializeTooltips:function(){$('[data-toggle="tooltip"]').tooltip({container:"body"})}};Utilities=new Utilities;DialogUtilities=function(){};DialogUtilities.prototype={showDialog:function(n,t,i,r){var u=$("#modal-default"),e,o,s,f;if(u.find(".modal-title").text(n),u.find(".modal-body").html(t),e=u.find(".modal-dialog"),e.removeClass("modal-sm").removeClass("modal-lg"),r.size&&e.addClass("modal-"+r.size),o=u.find(".modal-footer"),o.removeClass("right"),r.buttonsRight&&o.addClass("right"),s=u.modal(),s.off("click","#action-button"),f=u.find("#action-button"),f.text(r.actionButtonText?r.actionButtonText:"Save changes"),r.hideActionButton?f.hide():f.show(),i)s.on("click","#action-button",function(){f.prop("disabled",!0);i()})},unlockActionButton:function(){$("#modal-default #action-button").prop("disabled",!1)},setDialogActionButtonVisible:function(n){var t=$("#modal-default #action-button");n?t.show():t.hide()},closeDialog:function(){$("#modal-default #close-button").click()}};DialogUtilities=new DialogUtilities;CharacterServices=function(){this.purchaseUrl=null};CharacterServices.ActionType={EnableDualSpec:1,SwitchSpecialization:2,NameChange:3};CharacterServices.prototype={initialize:function(){var n=this,t=Handlebars.compile($("#confirm-tmpl").html());$(".character-card .action-link").on("click",function(i){var e;i.preventDefault();var u=$(this),r=n.getActionProperties(u),f={Name:u.data("cname"),Action:r.ActionType};r.ActionType===CharacterServices.ActionType.SwitchSpecialization&&(f.NewSpec=r.NewSpec);e={Title:r.DialogTitle,Body:t(f),ActionButtonText:r.ActionButtonText,Request:{Method:"POST",Url:n.purchaseUrl,Data:{characterGuid:u.data("guid")},OnSuccessCloseCallback:r.OnSuccessCloseCallback}};Utilities.ajaxDialog(e)})},getActionProperties:function(n){var i=n.data("action"),t;switch(i){case"enableDualSpec":return{ActionType:CharacterServices.ActionType.EnableDualSpec,DialogTitle:"Enable Dual Specialization",ActionButtonText:"Confirm",OnSuccessCloseCallback:()=>{location.reload()}};case"switchSpec":return t=n.find(".new-spec"),{ActionType:CharacterServices.ActionType.SwitchSpecialization,DialogTitle:"Switch Specialization",ActionButtonText:"Confirm",NewSpec:t.text(),OnSuccessCloseCallback:()=>{n.parent().find(".char-service-status .current-spec").text("("+t.text()+")"),t.text(t.text()==="Primary"?"Secondary":"Primary")}};case"nameChange":return{ActionType:CharacterServices.ActionType.NameChange,DialogTitle:"Change Name",ActionButtonText:"Confirm",OnSuccessCloseCallback:()=>{n.parent().find(".char-service-status").text("Pending").removeClass("enabled").addClass("pending"),n.removeClass("action-link").addClass("disabled"),n.off("click")}}}return{}}};ArenaHistory=function(){this.matches=null;this.getMatchDetailsUrl=null};ArenaHistory.prototype={initialize:function(){var n=this;n.matches=[];$("#match-history-table").on("click",".match-details",function(t){var i,r,u;if(t.preventDefault(),i=$(this).closest("tr"),r=i.data("id"),i.hasClass("toggled")){$(".details-"+r).remove();i.removeClass("toggled");return}i.addClass("toggled");u=$.Enumerable.From(n.matches).Where("x => x.id == "+r).FirstOrDefault();u===undefined?Utilities.ajaxGet(n.getMatchDetailsUrl+"&matchId="+r,function(t){n.matches.push({id:r,html:t});n.appendDetailsToRow(i,r)}):n.appendDetailsToRow(i,r)});$("#match-history-table").DataTable({iDisplayLength:25,lengthChange:!1,searching:!1,ordering:!1})},appendDetailsToRow:function(n,t){var i=this;n.after($.Enumerable.From(i.matches).First("x => x.id == "+t).html)}};ArmorySearch=function(){this.characterCount=null;this.guildCount=null;this.teamCount=null};ArmorySearch.prototype={initialize:function(){var n=this,t={iDisplayLength:10,lengthChange:!1,searching:!1,ordering:!1};n.characterCount>0&&$("#char").DataTable(t);n.guildCount>0&&$("#guild").DataTable(t);n.teamCount>0&&$("#team").DataTable(t)}};